dnl Process this file with autoconf to produce a configure script.
AC_REVISION($Revision$)
AC_INIT(Apache Kerberos Module, 0.5-rc1, modauthkerb-developers@lists.sourceforge.net)

AC_ARG_WITH(apache,
   [  --with-apache=DIR directory with apache installation.],
   [], [])
   
AC_ARG_WITH(kerberos5,
   [  --with-kerberos5=DIR directory where Kerberos5 is installed.],
   [], [])

AC_ARG_ENABLE(krb5,
[  --disable-krb5                      force disabling of krb5 support],

AC_ARG_WITH(kerberos4,
   [  --with-kerberos4=DIR directory where Kerberos4 is installed.]
   [] [])

AC_ARG_ENABLE(krb4,
[  --disable-krb4                      force disabling of krb4 support],

dnl Checks for programs.
AC_PROG_CC
AC_PROG_MAKE_SET
if test -z "$ac_static" ; then
	AC_PATH_PROG(APXS, apxs)
	if test -z "$APXS" ; then
		echo "No apxs found.  Defaulting to static module generation."
		ac_static="yes"
	fi
fi

dnl Checks for typedefs, structures, and compiler characteristics.
if test -z "$ac_api" ; then
	if test -n "`$APXS -q bindir 2> /dev/null`" ; then
		echo "API autodetected to be Apache 2.*"
		ac_api=apache2
		ac_apidefs="-DAPXS2"
	else
		echo "API autodetected to be Apache 1.*"
		ac_api=apache1
		ac_apidefs="-DAPXS1"
	fi
fi


dnl Checks for library functions.


dnl Last minute settings.
LIBS="$LIBS $ac_krblibs"
DEFS="$DEFS $ac_apidefs $ac_krbdefs"
CFLAGS="$CFLAGS $DEFS"


dnl Create files necessary to compile mod_auth_kerb.
if test "$ac_static" = "yes" ; then
	echo ""
	echo ""
	echo "This module is to be built statically into Apache.  You will need"
	echo "to place it into the appropriate location in the source tree and"
	echo "compile Apache accordingly.  You can look at the online docs at"
	echo "http://modauthkerb.sourceforge.net/ or README.static for more"
	echo "information."
	echo ""
	echo ""
else
	AC_OUTPUT(Makefile)
	AC_OUTPUT(src/Makefile)
fi

exit 0
