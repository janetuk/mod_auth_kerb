APXS = @APXS@
KRB5_CPPFLAGS = @KRB5_CPPFLAGS@
KRB5_LDFLAGS = @KRB5_LDFLAGS@
LIB_resolv = @LIB_resolv@
SPNEGO_SRCS = @SPNEGO_SRCS@

CPPFLAGS = -I. -Ispnegokrb5 $(KRB5_CPPFLAGS) $(DEFS)
LDFLAGS = $(KRB5_LDFLAGS) $(LIB_resolv)
CFLAGS =

all: src/mod_auth_kerb.so

src/mod_auth_kerb.so: src/mod_auth_kerb.c $(SPNEGO_SRCS)
	./apxs.sh "${CPPFLAGS}" "${LDFLAGS}" "${SPNEGO_SRCS}" "${APXS}" "-c" "src/mod_auth_kerb.c"

install:
	./apxs.sh "${CPPFLAGS}" "${LDFLAGS}" "${SPNEGO_SRCS}" "${APXS}" "-c -i" "src/mod_auth_kerb.c"

clean:
	for i in . src spnegokrb5; do \
		$(RM) $$i/*.{o,so,a,la,lo,slo} core; \
		$(RM) -rf $$i/.libs; \
	done

distclean: clean
	$(RM) config.h config.status Makefile config.log
	$(RM) -rf autom4te.cache

dist-gzip:
	git archive  --prefix mod_auth_gssapi/ HEAD |gzip -9 >@PACKAGE_TARNAME@-@PACKAGE_VERSION@.tar.gz
.PHONY: all install clean distclean dist-gzip
